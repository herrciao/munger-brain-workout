<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èŠ’æ ¼æ€ç¶­æ¨¡å‹è¨“ç·´æ¸¬é©— v2.0</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      background: #f5f5f0;
      color: #2c2c2c;
      line-height: 1.7;
      min-height: 100vh;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 24px 20px 60px;
    }

    /* â”€â”€ é ‚éƒ¨æ¨™é¡Œ â”€â”€ */
    header {
      text-align: center;
      padding: 40px 0 20px;
      border-bottom: 2px solid #d4d0c8;
      margin-bottom: 32px;
    }
    header h1 {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    header p {
      font-size: 0.95rem;
      color: #666;
    }
    header .version {
      font-size: 0.75rem;
      color: #aaa;
      margin-top: 6px;
    }

    /* â”€â”€ é€²åº¦æ¢ â”€â”€ */
    .progress-bar {
      background: #e0ddd5;
      border-radius: 6px;
      height: 8px;
      margin-bottom: 28px;
      overflow: hidden;
    }
    .progress-bar .fill {
      background: #4a7c59;
      height: 100%;
      border-radius: 6px;
      transition: width 0.4s ease;
    }
    .progress-text {
      text-align: center;
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 20px;
    }

    /* â”€â”€ é¡Œç›®å¡ç‰‡ â”€â”€ */
    .question-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 28px 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .question-card .scenario {
      font-size: 1.05rem;
      margin-bottom: 20px;
      line-height: 1.8;
    }
    .question-card .scenario strong {
      color: #4a7c59;
    }

    /* â”€â”€ é¸é … â”€â”€ */
    .options { list-style: none; }
    .options li {
      background: #fafaf7;
      border: 2px solid #e8e5dd;
      border-radius: 8px;
      padding: 14px 18px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.98rem;
    }
    .options li:hover {
      border-color: #4a7c59;
      background: #f0f5f1;
    }
    .options li.selected {
      border-color: #4a7c59;
      background: #e8f0ea;
    }
    .options li.correct {
      border-color: #4a7c59;
      background: #d4edda;
    }
    .options li.wrong {
      border-color: #c0392b;
      background: #fce4e4;
    }
    .options li.disabled {
      cursor: default;
      opacity: 0.7;
    }
    .options li.disabled:hover {
      border-color: #e8e5dd;
      background: #fafaf7;
    }
    .options li.correct.disabled:hover {
      border-color: #4a7c59;
      background: #d4edda;
    }
    .options li.wrong.disabled:hover {
      border-color: #c0392b;
      background: #fce4e4;
    }

    /* â”€â”€ è§£æå€ â”€â”€ */
    .explanation {
      background: #f9f8f4;
      border-left: 4px solid #4a7c59;
      border-radius: 0 8px 8px 0;
      padding: 20px 22px;
      margin-top: 20px;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .explanation.show { display: block; }
    .explanation .result-tag {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .explanation .result-tag.correct { color: #27763a; }
    .explanation .result-tag.wrong { color: #c0392b; }
    .explanation .model-tag {
      display: inline-block;
      background: #4a7c59;
      color: #fff;
      padding: 3px 12px;
      border-radius: 4px;
      font-size: 0.82rem;
      margin-bottom: 10px;
      margin-right: 6px;
    }
    .explanation .model-tag.secondary {
      background: #7a9e7e;
    }
    .explanation .detail {
      font-size: 0.93rem;
      color: #444;
      margin-top: 8px;
      line-height: 1.8;
    }
    .explanation .wrong-reasons {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed #ccc;
      font-size: 0.88rem;
      color: #666;
    }
    .explanation .wrong-reasons strong {
      color: #555;
    }

    /* â”€â”€ æŒ‰éˆ• â”€â”€ */
    .btn {
      display: inline-block;
      padding: 12px 32px;
      background: #4a7c59;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 16px;
    }
    .btn:hover { background: #3d6a4a; }
    .btn:disabled {
      background: #bbb;
      cursor: not-allowed;
    }
    .btn-center { text-align: center; }

    /* â”€â”€ é–‹å§‹é  & çµæœé  â”€â”€ */
    .start-page, .result-page {
      text-align: center;
      padding: 60px 20px;
    }
    .start-page h2 {
      font-size: 1.4rem;
      margin-bottom: 12px;
    }
    .start-page p {
      color: #666;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    .start-page .note {
      font-size: 0.85rem;
      color: #999;
      margin-top: 20px;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .result-page h2 {
      font-size: 1.5rem;
      margin-bottom: 16px;
    }
    .result-page .score {
      font-size: 3rem;
      font-weight: 800;
      color: #4a7c59;
      margin: 16px 0;
    }
    .result-page .score span {
      font-size: 1.2rem;
      color: #888;
      font-weight: 400;
    }
    .result-page .summary {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 24px;
      text-align: left;
      margin: 24px 0;
      font-size: 0.93rem;
      line-height: 1.8;
    }
    .result-page .summary h3 {
      margin-bottom: 12px;
      font-size: 1.05rem;
    }
    .result-page .model-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .result-page .model-list .tag {
      background: #e8f0ea;
      color: #3d6a4a;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.82rem;
    }
    .result-page .model-list .tag.missed {
      background: #fce4e4;
      color: #a33;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€ èŠ’æ ¼èªéŒ„å¡ç‰‡ â”€â”€ */
    .munger-quote {
      background: #2c2c2c;
      color: #e8e5dd;
      border-radius: 12px;
      padding: 32px 28px;
      margin: 28px 0;
      position: relative;
    }
    .munger-quote::before {
      content: 'ã€Œ';
      font-size: 4rem;
      color: #4a7c59;
      position: absolute;
      top: 8px;
      left: 16px;
      line-height: 1;
      opacity: 0.5;
    }
    .munger-quote .quote-text {
      font-size: 1.05rem;
      line-height: 1.9;
      padding-left: 8px;
      font-style: italic;
    }
    .munger-quote .quote-source {
      text-align: right;
      margin-top: 16px;
      font-size: 0.8rem;
      color: #999;
    }

    /* â”€â”€ Beta è¨»å†Šå€ â”€â”€ */
    .beta-section {
      background: linear-gradient(135deg, #f0f5f1 0%, #e8f0ea 100%);
      border: 2px solid #4a7c59;
      border-radius: 12px;
      padding: 32px 28px;
      margin: 28px 0;
      text-align: center;
    }
    .beta-section h3 {
      font-size: 1.15rem;
      margin-bottom: 8px;
      color: #2c2c2c;
    }
    .beta-section p {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 20px;
    }
    .beta-form {
      display: flex;
      gap: 10px;
      max-width: 440px;
      margin: 0 auto;
    }
    .beta-form input[type="email"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #d4d0c8;
      border-radius: 8px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .beta-form input[type="email"]:focus {
      border-color: #4a7c59;
    }
    .beta-form button {
      padding: 12px 24px;
      background: #4a7c59;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .beta-form button:hover { background: #3d6a4a; }
    .beta-form button:disabled {
      background: #bbb;
      cursor: not-allowed;
    }
    .beta-success {
      color: #27763a;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 12px 0;
    }
    .beta-note {
      font-size: 0.78rem;
      color: #999;
      margin-top: 12px;
    }

    /* â”€â”€ æ¨¡å¼é¸æ“‡å¡ç‰‡ â”€â”€ */
    .mode-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 24px 0;
      text-align: left;
    }
    .mode-card {
      background: #fff;
      border: 2px solid #e8e5dd;
      border-radius: 10px;
      padding: 18px 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .mode-card:hover {
      border-color: #4a7c59;
      background: #f0f5f1;
    }
    .mode-card.selected {
      border-color: #4a7c59;
      background: #e8f0ea;
    }
    .mode-card .mode-title {
      font-weight: 700;
      font-size: 1.05rem;
      margin-bottom: 4px;
    }
    .mode-card .mode-desc {
      font-size: 0.85rem;
      color: #666;
      line-height: 1.5;
    }
    .mode-card .mode-tag {
      display: inline-block;
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 4px;
      margin-left: 8px;
      vertical-align: middle;
    }
    .mode-tag.tag-v1 { background: #e8f0ea; color: #3d6a4a; }
    .mode-tag.tag-v2 { background: #fef3cd; color: #856404; }
    .mode-tag.tag-all { background: #f0e6f6; color: #6f42c1; }

    /* â”€â”€ RWD â”€â”€ */
    @media (max-width: 480px) {
      .container { padding: 16px 14px 40px; }
      header h1 { font-size: 1.3rem; }
      .question-card { padding: 20px 16px; }
      .beta-form { flex-direction: column; }
      .munger-quote { padding: 28px 20px; }
    }
  </style>
</head>
<body>
<div class="container" id="app">
  <!-- ç”± JS æ¸²æŸ“ -->
</div>

<!-- é¡Œåº«ï¼ˆæ¨¡çµ„åŒ–è¼‰å…¥ï¼Œæ–¹ä¾¿ç¶­è­·èˆ‡æ“´å……ï¼‰ -->
<script src="questions/_loader.js"></script>
<script src="questions/01-general.js"></script>
<script src="questions/02-math.js"></script>
<script src="questions/03-systems.js"></script>
<script src="questions/04-physics-bio.js"></script>
<script src="questions/05-psychology.js"></script>
<script src="questions/06-economics-war.js"></script>
<script src="questions/07-cross-fusion.js"></script>
<script src="questions/08-reverse-diag.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èŠ’æ ¼æ€ç¶­æ¨¡å‹è¨“ç·´æ¸¬é©— v1.0 â€” 2026-02-10
//  é¡Œåº« 100 é¡Œï¼Œæ¯æ¬¡éš¨æ©ŸæŠ½ 20 é¡Œ
//  èª˜é¤Œé¸é …ä¾†æºï¼šKahneman / Eyal / Lindstrom / Greene
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const VERSION = 'v2.0 â€” 2026-02-11';
const QUIZ_SIZE = 20;

// â”€â”€ é¡Œåº«åˆ†é¡ â”€â”€
const v1Questions = allQuestions.filter(q => !q.type);
const v2Questions = allQuestions.filter(q => q.type === 'cross-fusion' || q.type === 'reverse-diag');

// â”€â”€ æ¨¡å¼å®šç¾© â”€â”€
let quizMode = 'classic'; // classic | advanced | challenge

// â”€â”€ èŠ’æ ¼èªéŒ„ï¼ˆæ‘˜è‡ªã€Šçª®æŸ¥ç†çš„æ™®é€šå¸¸è­˜ã€‹ï¼‰ â”€â”€
const MUNGER_QUOTES = [
  "æˆ‘é€™è¼©å­é‡åˆ°çš„è°æ˜äººï¼ˆä¾†è‡ªå„è¡Œå„æ¥­ï¼‰æ²’æœ‰ä¸æ¯å¤©é–±è®€çš„ï¼Œæ²’æœ‰ï¼Œä¸€å€‹éƒ½æ²’æœ‰ã€‚",
  "æˆ‘å€‘è³ºéŒ¢ï¼Œé çš„æ˜¯è¨˜ä½æ·ºé¡¯çš„ï¼Œè€Œä¸æ˜¯æŒæ¡æ·±å¥§çš„ã€‚",
  "å¦‚æœä½ åœ¨ç”Ÿæ´»ä¸­å”¯ä¸€çš„æˆåŠŸå°±æ˜¯é€éè²·è‚¡ç¥¨ç™¼è²¡ï¼Œé‚£éº¼é€™æ˜¯ä¸€ç¨®å¤±æ•—çš„ç”Ÿæ´»ï¼›ç”Ÿæ´»ä¸åƒ…åƒ…æ˜¯ç²¾æ˜çš„ç´¯ç©è²¡å¯Œã€‚",
  "ç”Ÿæ´»å’Œäº‹æ¥­ä¸Šçš„æˆåŠŸï¼Œå¤§å¤šä¾†è‡ªä½ çŸ¥é“æ‡‰è©²é¿å…å“ªäº›äº‹æƒ…ï¼šæ­»å¾—å¤ªæ—©ã€ç³Ÿç³•çš„å©šå§»ç­‰ç­‰ã€‚",
  "å¼•é€²æ–°è§€å¿µä¸¦ä¸é›£ï¼Œé›£çš„æ˜¯æ¸…é™¤èˆŠè§€å¿µã€‚",
  "ä¸è‡ªæ¬ºçš„ç²¾ç¥æ˜¯æœ€å¥½çš„ç²¾ç¥ï¼Œé€™ç¨®ç²¾ç¥éå¸¸å¼·å¤§ï¼Œå› ç‚ºå¤ªç½•è¦‹äº†ã€‚",
  "æ“æœ‰å¸¸è­˜ä¸ä½†æ„å‘³è‘—æœ‰èƒ½åŠ›è¾¨èªæ™ºæ…§ï¼Œä¹Ÿæ„å‘³æœ‰èƒ½åŠ›æ‹’çµ•æ„šè ¢ã€‚å¦‚æœæ’é™¤äº†è¨±å¤šè ¢äº‹ï¼Œå°±ä¸æœƒæŠŠè‡ªå·±æå¾—ä¸€åœ˜ç³Ÿã€‚",
  "æ‰¾åˆ°å¥½é…å¶çš„æœ€ä½³æ–¹æ³•æ˜¯ä»€éº¼å‘¢ï¼Ÿå”¯ä¸€ä¹‹é“æ˜¯ä½ é¦–å…ˆå¿…é ˆå€¼å¾—æ“æœ‰å¥½é…å¶ï¼Œå› ç‚ºå¾å®šç¾©ä¸Šä¾†èªªï¼Œå¥½é…å¶å¯çµ•ä¸æ˜¯å‚»ç“œã€‚",
  "æˆ‘é‚„æœªè½èªªæœ‰èª°èƒ½å¤ å¾ˆå¿«æˆç‚ºä¸€åå‰å¤§çš„æŠ•è³‡è€…ã€‚æ‰€ä»¥è¨£ç«…åœ¨æ–¼ä¸æ–·å­¸ç¿’ã€‚ä½ å¿…é ˆå–œæ­¡å­¸ç¿’çš„éç¨‹ã€‚",
  "æ¿€æƒ…å’Œå¤©åˆ†ï¼Œå“ªå€‹æ›´é‡è¦å‘¢ï¼Ÿæˆ‘èªç‚ºæ¿€æƒ…æ¯”é ­è…¦çš„èƒ½åŠ›æ›´åŠ é‡è¦ã€‚",
  "æˆ‘æ‰‹è£¡åªè¦æœ‰ä¸€æœ¬æ›¸ï¼Œå°±ä¸æœƒè¦ºå¾—æµªè²»æ™‚é–“ã€‚",
  "ç²å–æ™®ä¸–çš„æ™ºæ…§ï¼Œä¸¦ç›¸å°èª¿æ•´ä½ çš„è¡Œç‚ºï¼Œå³ä½¿ç‰¹ç«‹ç¨è¡Œè®“ä½ åœ¨äººç¾¤ä¸­ä¸å—æ­¡è¿â€¦â€¦é‚£å°±éš¨ä¾¿ä»–å€‘å§ã€‚",
  "é—œå¿ƒåˆ¥äººè³ºéŒ¢æ¯”è‡ªå·±æ›´å¿«ï¼Œæ˜¯ä¸€ç¨®è‡´å‘½çš„ç½ªã€‚å¦’å¿ŒçœŸæ˜¯ä¸€ç¨®æ„šè ¢çš„ç½ªï¼Œæ˜¯å”¯ä¸€ä¸€ç¨®ä¸å¯èƒ½å¾—åˆ°ä»»ä½•æ¨‚è¶£çš„ç½ªè¡Œã€‚",
  "å¦‚æœçƒé¾œèƒ½å¤ å¾å®ƒé‚£äº›æœ€æ£’å‰è¼©èº«ä¸Šï¼Œæ±²å–å·²ç¶“éå¯¦è¸é©—è­‰çš„æ´è¦‹ï¼Œé‚£éº¼å®ƒä¹Ÿèƒ½è·‘è´é‚£äº›è¿½æ±‚ç¨å‰µæ€§ã€ä¸é¡˜å‘å„ªç§€å‰è¼©å­¸ç¿’çš„å…”å­ã€‚",
  "å”¯ä¸€çš„ç²å‹æ–¹æ³•æ˜¯å·¥ä½œã€å·¥ä½œã€å·¥ä½œã€å·¥ä½œï¼Œä¸¦å¸Œæœ›æ“æœ‰ä¸€é»æ´è¦‹ã€‚",
  "å¦‚æœä½ ä¸€é–‹å§‹å°±èƒ½å¤ åœ¨è«¸å¦‚èª å¯¦é€™æ¨£ç°¡å–®çš„äº‹æƒ…ä¸Šæ“æœ‰å®Œç¾ç´€éŒ„ï¼Œå°‡æœƒåœ¨é€™å€‹ä¸–ç•Œä¸Šèµ°å¾—å¾ˆé ã€‚",
  "ä½ ä¸€æ—¦é–‹å§‹åšå£äº‹ï¼Œç¬¬äºŒæ¬¡åšå°±å®¹æ˜“å¤šäº†ï¼Œåˆ°æœ€å¾Œï¼Œå°±æœƒé“å¾·æ·ªå–ªã€‚",
  "äººå€‘è¨ˆç®—å¾—å¤ªå¤šï¼Œæ€è€ƒå¾—å¤ªå°‘ã€‚",
  "åˆ¥åªçœ‹åˆ°éŒ¢ã€‚é¸æ“‡ä½ é¡˜æ„èˆ‡ä»–äº¤æœ‹å‹çš„å®¢æˆ¶ã€‚"
];

// â”€â”€ Fisher-Yates Shuffle â”€â”€
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// â”€â”€ æ‡‰ç”¨ç‹€æ…‹ â”€â”€
let activeQuiz = [];     // æœ¬è¼ªæŠ½åˆ°çš„ 20 é¡Œ
let currentIndex = 0;
let score = 0;
let answers = [];
let answered = false;

const app = document.getElementById('app');

// â”€â”€ æ¸²æŸ“ header â”€â”€
function headerHTML() {
  const modeLabels = { classic: 'ç¶“å…¸æ¨¡å¼', advanced: 'é€²éšæ¨¡å¼', challenge: 'å…¨é¢æŒ‘æˆ°' };
  const quizTotal = quizMode === 'challenge' ? allQuestions.length : QUIZ_SIZE;
  return `
    <header>
      <h1>æŸ¥ç†ãƒ»èŠ’æ ¼ æ€ç¶­æ¨¡å‹è¨“ç·´</h1>
      <p>ä»¥ 100+ å€‹æ€ç¶­æ¨¡å‹ç‚ºåŸºç¤çš„æƒ…å¢ƒå¼æ¸¬é©—</p>
      <div class="version">${VERSION}ï½œé¡Œåº« ${allQuestions.length} é¡Œï½œ${modeLabels[quizMode]} Â· ${quizTotal} é¡Œ</div>
    </header>
  `;
}

// â”€â”€ æ¸²æŸ“ï¼šé–‹å§‹é  â”€â”€
function renderStart() {
  app.innerHTML = `
    ${headerHTML()}
    <div class="start-page">
      <h2>æ­¡è¿ä¾†åˆ°æ€ç¶­è¨“ç·´å ´</h2>
      <p>é¡Œåº«å…± <strong>${allQuestions.length} é“æƒ…å¢ƒé¡Œ</strong>ï¼ˆv1 ç¶“å…¸ ${v1Questions.length} é¡Œ + v2 é€²éš ${v2Questions.length} é¡Œï¼‰</p>
      <p>æ¯ä¸€é¡Œä½œç­”å¾Œï¼Œä½ æœƒçœ‹åˆ°å°æ‡‰çš„èŠ’æ ¼æ€ç¶­æ¨¡å‹èˆ‡è©³ç´°è§£æã€‚</p>

      <div class="mode-cards">
        <div class="mode-card ${quizMode === 'classic' ? 'selected' : ''}" onclick="selectMode('classic')">
          <div class="mode-title">ç¶“å…¸æ¨¡å¼ <span class="mode-tag tag-v1">v1</span></div>
          <div class="mode-desc">å¾å…¨éƒ¨ ${allQuestions.length} é¡Œä¸­éš¨æ©ŸæŠ½ ${QUIZ_SIZE} é¡Œã€‚æ¶µè“‹æ‰€æœ‰é¡Œå‹ï¼Œé©åˆæ—¥å¸¸ç·´ç¿’ã€‚</div>
        </div>
        <div class="mode-card ${quizMode === 'advanced' ? 'selected' : ''}" onclick="selectMode('advanced')">
          <div class="mode-title">é€²éšæ¨¡å¼ <span class="mode-tag tag-v2">v2 NEW</span></div>
          <div class="mode-desc">åªå¾ ${v2Questions.length} é¡Œé€²éšé¡Œä¸­æŠ½ ${QUIZ_SIZE} é¡Œã€‚åŒ…å«äº¤å‰èåˆé¡Œèˆ‡åå‘è¨ºæ–·é¡Œï¼Œé¡¯è‘—æ›´é›£ã€‚</div>
        </div>
        <div class="mode-card ${quizMode === 'challenge' ? 'selected' : ''}" onclick="selectMode('challenge')">
          <div class="mode-title">å…¨é¢æŒ‘æˆ° <span class="mode-tag tag-all">FULL</span></div>
          <div class="mode-desc">å…¨éƒ¨ ${allQuestions.length} é¡Œï¼Œéš¨æ©Ÿé †åºï¼Œä¸€æ¬¡åšå®Œã€‚é©åˆæƒ³è¦å®Œæ•´æ¸¬è©¦çš„ç¡¬æ ¸ç©å®¶ã€‚</div>
        </div>
      </div>

      <div class="note">
        é€™ä¸æ˜¯è€ƒè©¦ï¼Œè€Œæ˜¯ä¸€å€‹<strong>ã€Œè¨“ç·´ä½ åœ¨ç¾å¯¦ä¸­ç”¨å°æ€ç¶­æ¨¡å‹ã€</strong>çš„å·¥å…·ã€‚<br>
        é‡é»æ˜¯å½¢æˆæ­£ç¢ºçš„ç›´è¦ºï¼Œè€Œéè¿½æ±‚åˆ†æ•¸ã€‚æ¯æ¬¡é‡ä¾†éƒ½æ˜¯ä¸åŒçš„é¡Œç›®çµ„åˆã€‚
      </div>
      <button class="btn" onclick="startQuiz()">é–‹å§‹è¨“ç·´</button>
    </div>
  `;
}

function selectMode(mode) {
  quizMode = mode;
  renderStart();
}

// â”€â”€ æ¸²æŸ“ï¼šé¡Œç›® â”€â”€
function renderQuestion() {
  const q = activeQuiz[currentIndex];
  const total = activeQuiz.length;
  const pct = ((currentIndex) / total * 100).toFixed(0);

  app.innerHTML = `
    ${headerHTML()}
    <div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div>
    <div class="progress-text">ç¬¬ ${currentIndex + 1} é¡Œ / å…± ${total} é¡Œ</div>

    <div class="question-card">
      <div class="scenario">${q.scenario}</div>
      <ul class="options" id="optionsList">
        ${q.options.map((opt, i) => `<li data-idx="${i}" onclick="selectOption(${i})">${opt}</li>`).join('')}
      </ul>

      <div class="explanation" id="explanation">
        <div class="result-tag" id="resultTag"></div>
        <div id="modelTags"></div>
        <div class="detail" id="expDetail"></div>
        <div class="wrong-reasons" id="wrongReasons"></div>
      </div>
    </div>

    <div class="btn-center">
      <button class="btn" id="nextBtn" style="display:none" onclick="nextQuestion()">
        ${currentIndex < activeQuiz.length - 1 ? 'ä¸‹ä¸€é¡Œ â†’' : 'æŸ¥çœ‹çµæœ'}
      </button>
    </div>
  `;
  answered = false;
}

// â”€â”€ é¸æ“‡é¸é … â”€â”€
function selectOption(idx) {
  if (answered) return;
  answered = true;

  const q = activeQuiz[currentIndex];
  const isCorrect = idx === q.answer;
  if (isCorrect) score++;
  answers.push({ qIndex: currentIndex, selected: idx, correct: isCorrect });

  const lis = document.querySelectorAll('#optionsList li');
  lis.forEach((li, i) => {
    li.classList.add('disabled');
    if (i === q.answer) li.classList.add('correct');
    if (i === idx && !isCorrect) li.classList.add('wrong');
  });

  const expEl = document.getElementById('explanation');
  const tagEl = document.getElementById('resultTag');
  const modelEl = document.getElementById('modelTags');
  const detailEl = document.getElementById('expDetail');
  const wrongEl = document.getElementById('wrongReasons');

  tagEl.textContent = isCorrect ? 'âœ… æ­£ç¢ºï¼' : 'âŒ éŒ¯èª¤';
  tagEl.className = 'result-tag ' + (isCorrect ? 'correct' : 'wrong');

  let tagsHTML = q.models.map(m => `<span class="model-tag">ä¸»è¦æ¨¡å‹ï¼š${m}</span>`).join('');
  if (q.secondaryModels && q.secondaryModels.length > 0) {
    tagsHTML += q.secondaryModels.map(m => `<span class="model-tag secondary">è¼”åŠ©æ¨¡å‹ï¼š${m}</span>`).join('');
  }
  modelEl.innerHTML = tagsHTML;
  detailEl.innerHTML = q.explanation;
  wrongEl.innerHTML = `<strong>ç‚ºä»€éº¼å…¶ä»–é¸é …çœ‹èµ·ä¾†åˆç†ä½†å¯¦éš›ä¸ŠéŒ¯ï¼š</strong><br>${q.wrongReasons}`;

  expEl.classList.add('show');
  document.getElementById('nextBtn').style.display = 'inline-block';

  setTimeout(() => expEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
}

// â”€â”€ ä¸‹ä¸€é¡Œ â”€â”€
function nextQuestion() {
  currentIndex++;
  if (currentIndex < activeQuiz.length) {
    renderQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    renderResult();
  }
}

// â”€â”€ æ¸²æŸ“ï¼šçµæœé  â”€â”€
function renderResult() {
  const correctModels = [];
  const wrongModels = [];
  answers.forEach(a => {
    const q = activeQuiz[a.qIndex];
    const allModels = [...q.models, ...(q.secondaryModels || [])];
    if (a.correct) {
      correctModels.push(...allModels);
    } else {
      wrongModels.push(...allModels);
    }
  });

  const uniqueCorrect = [...new Set(correctModels)];
  const uniqueWrong = [...new Set(wrongModels)];

  const total = activeQuiz.length;
  const pctScore = score / total;
  let level = '';
  if (pctScore >= 0.9) level = 'ğŸ† èŠ’æ ¼ç´šæ€ç¶­å¤§å¸«â€”â€”ä½ çš„å¤šå…ƒæ¨¡å‹æ ¼å­å·²ç¶“ç›¸ç•¶å®Œå–„ï¼';
  else if (pctScore >= 0.7) level = 'ğŸ“ˆ å„ªç§€çš„è·¨å­¸ç§‘æ€è€ƒè€…â€”â€”ç¹¼çºŒç·´ç¿’ï¼ŒæŠŠæ¨¡å‹å…§åŒ–ç‚ºç›´è¦ºã€‚';
  else if (pctScore >= 0.5) level = 'ğŸ” æœ‰æ½›åŠ›çš„ç†æ€§æ±ºç­–è€…â€”â€”å»ºè­°é‡æ–°é–±è®€ç­”éŒ¯é¡Œç›®çš„æ¨¡å‹èªªæ˜ã€‚';
  else level = 'ğŸ“š æ€ç¶­è¨“ç·´æ–°æ‰‹â€”â€”æ²’é—œä¿‚ï¼èŠ’æ ¼èªªã€Œä¸€ç”ŸæŒçºŒå­¸ç¿’ã€ï¼Œç¾åœ¨å°±æ˜¯æœ€å¥½çš„é–‹å§‹ã€‚';

  // éš¨æ©Ÿé¸ä¸€æ¢èŠ’æ ¼èªéŒ„
  const randomQuote = MUNGER_QUOTES[Math.floor(Math.random() * MUNGER_QUOTES.length)];

  app.innerHTML = `
    ${headerHTML()}
    <div class="result-page">
      <h2>è¨“ç·´çµæœ</h2>
      <div class="score">${score} <span>/ ${total}</span></div>
      <p>${level}</p>

      <div class="summary">
        <h3>ä½ æŒæ¡å¾—è¼ƒå¥½çš„æ€ç¶­æ¨¡å‹ï¼š</h3>
        <div class="model-list">
          ${uniqueCorrect.length > 0
            ? uniqueCorrect.map(m => `<span class="tag">${m}</span>`).join('')
            : '<span style="color:#999">ï¼ˆç„¡ï¼‰</span>'}
        </div>
      </div>

      <div class="summary">
        <h3>å»ºè­°åŠ å¼·çš„æ€ç¶­æ¨¡å‹ï¼š</h3>
        <div class="model-list">
          ${uniqueWrong.length > 0
            ? uniqueWrong.map(m => `<span class="tag missed">${m}</span>`).join('')
            : '<span style="color:#4a7c59">å…¨éƒ¨ç­”å°ï¼å¤ªå²å®³äº†ã€‚</span>'}
        </div>
      </div>

      <div class="munger-quote">
        <div class="quote-text">${randomQuote}</div>
        <div class="quote-source">â€”â€”æŸ¥ç†Â·èŠ’æ ¼ã€Šçª®æŸ¥ç†çš„æ™®é€šå¸¸è­˜ã€‹</div>
      </div>

      <p style="font-size:0.88rem;color:#666;text-align:center;margin:8px 0 24px;">
        æ¯æ¬¡é‡ä¾†éƒ½æ˜¯ä¸åŒçš„é¡Œç›®çµ„åˆã€‚æŒçºŒè¨“ç·´ï¼Œç›´åˆ°èŠ’æ ¼çš„æ€ç¶­æ¨¡å‹æˆç‚ºä½ çš„æœ¬èƒ½åæ‡‰ã€‚
      </p>

      <button class="btn" onclick="resetQuiz()">å†ä¾†ä¸€è¼ªï¼ˆéš¨æ©Ÿæ–°é¡Œï¼‰</button>

      <div class="beta-section">
        <h3>å–œæ­¡é€™å€‹è¨“ç·´å—ï¼Ÿ</h3>
        <p>ç•™ä¸‹ä½ çš„ Emailï¼Œæ¶å…ˆæˆç‚º Beta ç‰ˆç”¨æˆ¶ã€‚<br>æˆ‘å€‘æ­£åœ¨æ‰“é€ æ›´å®Œæ•´çš„æ€ç¶­è¨“ç·´ç³»çµ±ã€‚</p>
        <div id="beta-form-area">
          <form class="beta-form" onsubmit="handleBetaSignup(event)">
            <input type="email" id="beta-email" placeholder="your@email.com" required>
            <button type="submit">æˆ‘è¦åŠ å…¥</button>
          </form>
        </div>
        <div class="beta-note">æˆ‘å€‘ä¸æœƒå¯„åƒåœ¾ä¿¡ï¼Œåƒ…ç”¨æ–¼ Beta ç‰ˆæœ¬ç™¼å¸ƒé€šçŸ¥ã€‚</div>
      </div>
    </div>
  `;
}

// â”€â”€ æ§åˆ¶ â”€â”€
function startQuiz() {
  let pool;
  if (quizMode === 'advanced') {
    pool = v2Questions;
  } else {
    pool = allQuestions;
  }
  const size = quizMode === 'challenge' ? pool.length : Math.min(QUIZ_SIZE, pool.length);
  activeQuiz = shuffle(pool).slice(0, size);
  currentIndex = 0;
  score = 0;
  answers = [];
  renderQuestion();
}

function resetQuiz() {
  activeQuiz = [];
  currentIndex = 0;
  score = 0;
  answers = [];
  renderStart();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€ Beta è¨»å†Š â”€â”€
function handleBetaSignup(e) {
  e.preventDefault();
  const emailInput = document.getElementById('beta-email');
  const email = emailInput.value.trim();
  if (!email) return;

  // å°‡ email å­˜å…¥ localStorageï¼ˆå‰ç«¯æš«å­˜ï¼Œä¹‹å¾Œå¯ä¸²æ¥å¾Œç«¯ APIï¼‰
  const existing = JSON.parse(localStorage.getItem('munger_beta_emails') || '[]');
  if (!existing.includes(email)) {
    existing.push(email);
    localStorage.setItem('munger_beta_emails', JSON.stringify(existing));
  }

  document.getElementById('beta-form-area').innerHTML =
    '<div class="beta-success">âœ… æ„Ÿè¬ä½ ï¼æˆ‘å€‘æœƒåœ¨ Beta ç‰ˆä¸Šç·šæ™‚é€šçŸ¥ä½ ã€‚</div>';
}

// â”€â”€ åˆå§‹åŒ– â”€â”€
renderStart();
</script>
</body>
</html>
